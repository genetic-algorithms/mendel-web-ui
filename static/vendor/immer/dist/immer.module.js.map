{"version":3,"file":"immer.module.js","sources":["../src/common.js","../src/proxy.js","../src/es5.js","../src/immer.js"],"sourcesContent":["export const PROXY_STATE =\n    typeof Symbol !== \"undefined\"\n        ? Symbol(\"immer-proxy-state\")\n        : \"__$immer_state\"\n\nexport const RETURNED_AND_MODIFIED_ERROR =\n    \"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.\"\n\nfunction verifyMinified() {}\n\nconst inProduction =\n    (typeof process !== \"undefined\" && process.env.NODE_ENV === \"production\") ||\n    verifyMinified.name !== \"verifyMinified\"\n\nlet autoFreeze = !inProduction\nlet useProxies = typeof Proxy !== \"undefined\"\n\n/**\n * Automatically freezes any state trees generated by immer.\n * This protects against accidental modifications of the state tree outside of an immer function.\n * This comes with a performance impact, so it is recommended to disable this option in production.\n * It is by default enabled.\n *\n * @returns {void}\n */\nexport function setAutoFreeze(enableAutoFreeze) {\n    autoFreeze = enableAutoFreeze\n}\n\nexport function setUseProxies(value) {\n    useProxies = value\n}\n\nexport function getUseProxies() {\n    return useProxies\n}\n\nexport function isProxy(value) {\n    return !!value && !!value[PROXY_STATE]\n}\n\nexport function isProxyable(value) {\n    if (!value) return false\n    if (typeof value !== \"object\") return false\n    if (Array.isArray(value)) return true\n    const proto = Object.getPrototypeOf(value)\n    return proto === null || proto === Object.prototype\n}\n\nexport function freeze(value) {\n    if (autoFreeze) {\n        Object.freeze(value)\n    }\n    return value\n}\n\nconst assign =\n    Object.assign ||\n    function assign(target, value) {\n        for (let key in value) {\n            if (has(value, key)) {\n                target[key] = value[key]\n            }\n        }\n        return target\n    }\n\nexport function shallowCopy(value) {\n    if (Array.isArray(value)) return value.slice()\n    const target = value.__proto__ === undefined ? Object.create(null) : {}\n    return assign(target, value)\n}\n\nexport function each(value, cb) {\n    if (Array.isArray(value)) {\n        for (let i = 0; i < value.length; i++) cb(i, value[i])\n    } else {\n        for (let key in value) cb(key, value[key])\n    }\n}\n\nexport function has(thing, prop) {\n    return Object.prototype.hasOwnProperty.call(thing, prop)\n}\n\n// given a base object, returns it if unmodified, or return the changed cloned if modified\nexport function finalize(base) {\n    if (isProxy(base)) {\n        const state = base[PROXY_STATE]\n        if (state.modified === true) {\n            if (state.finalized === true) return state.copy\n            state.finalized = true\n            return finalizeObject(\n                useProxies ? state.copy : (state.copy = shallowCopy(base)),\n                state\n            )\n        } else {\n            return state.base\n        }\n    }\n    finalizeNonProxiedObject(base)\n    return base\n}\n\nfunction finalizeObject(copy, state) {\n    const base = state.base\n    each(copy, (prop, value) => {\n        if (value !== base[prop]) copy[prop] = finalize(value)\n    })\n    return freeze(copy)\n}\n\nfunction finalizeNonProxiedObject(parent) {\n    // If finalize is called on an object that was not a proxy, it means that it is an object that was not there in the original\n    // tree and it could contain proxies at arbitrarily places. Let's find and finalize them as well\n    if (!isProxyable(parent)) return\n    if (Object.isFrozen(parent)) return\n    each(parent, (i, child) => {\n        if (isProxy(child)) {\n            parent[i] = finalize(child)\n        } else finalizeNonProxiedObject(child)\n    })\n    // always freeze completely new data\n    freeze(parent)\n}\n\nexport function verifyReturnValue(returnedValue, proxy, isProxyModified) {\n    if (returnedValue !== undefined && returnedValue !== proxy) {\n        // something was returned, and it wasn't the proxy itself\n        if (isProxyModified)\n            throw new Error(\n                \"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.\"\n            )\n    }\n}\n\nexport function is(x, y) {\n    // From: https://github.com/facebook/fbjs/blob/c69904a511b900266935168223063dd8772dfc40/packages/fbjs/src/core/shallowEqual.js\n    if (x === y) {\n        return x !== 0 || 1 / x === 1 / y\n    } else {\n        return x !== x && y !== y\n    }\n}\n","\"use strict\"\n// @ts-check\n\nimport {\n    is,\n    has,\n    isProxyable,\n    isProxy,\n    PROXY_STATE,\n    finalize,\n    shallowCopy,\n    RETURNED_AND_MODIFIED_ERROR,\n    each\n} from \"./common\"\n\nlet proxies = null\n\nconst objectTraps = {\n    get,\n    has(target, prop) {\n        return prop in source(target)\n    },\n    ownKeys(target) {\n        return Reflect.ownKeys(source(target))\n    },\n    set,\n    deleteProperty,\n    getOwnPropertyDescriptor,\n    defineProperty,\n    setPrototypeOf() {\n        throw new Error(\"Immer does not support `setPrototypeOf()`.\")\n    }\n}\n\nconst arrayTraps = {}\neach(objectTraps, (key, fn) => {\n    arrayTraps[key] = function() {\n        arguments[0] = arguments[0][0]\n        return fn.apply(this, arguments)\n    }\n})\n\nfunction createState(parent, base) {\n    return {\n        modified: false,\n        finalized: false,\n        parent,\n        base,\n        copy: undefined,\n        proxies: {}\n    }\n}\n\nfunction source(state) {\n    return state.modified === true ? state.copy : state.base\n}\n\nfunction get(state, prop) {\n    if (prop === PROXY_STATE) return state\n    if (state.modified) {\n        const value = state.copy[prop]\n        if (value === state.base[prop] && isProxyable(value))\n            // only create proxy if it is not yet a proxy, and not a new object\n            // (new objects don't need proxying, they will be processed in finalize anyway)\n            return (state.copy[prop] = createProxy(state, value))\n        return value\n    } else {\n        if (has(state.proxies, prop)) return state.proxies[prop]\n        const value = state.base[prop]\n        if (!isProxy(value) && isProxyable(value))\n            return (state.proxies[prop] = createProxy(state, value))\n        return value\n    }\n}\n\nfunction set(state, prop, value) {\n    if (!state.modified) {\n        if (\n            (prop in state.base && is(state.base[prop], value)) ||\n            (has(state.proxies, prop) && state.proxies[prop] === value)\n        )\n            return true\n        markChanged(state)\n    }\n    state.copy[prop] = value\n    return true\n}\n\nfunction deleteProperty(state, prop) {\n    markChanged(state)\n    delete state.copy[prop]\n    return true\n}\n\nfunction getOwnPropertyDescriptor(state, prop) {\n    const owner = state.modified\n        ? state.copy\n        : has(state.proxies, prop) ? state.proxies : state.base\n    const descriptor = Reflect.getOwnPropertyDescriptor(owner, prop)\n    if (descriptor && !(Array.isArray(owner) && prop === \"length\"))\n        descriptor.configurable = true\n    return descriptor\n}\n\nfunction defineProperty() {\n    throw new Error(\n        \"Immer does not support defining properties on draft objects.\"\n    )\n}\n\nfunction markChanged(state) {\n    if (!state.modified) {\n        state.modified = true\n        state.copy = shallowCopy(state.base)\n        // copy the proxies over the base-copy\n        Object.assign(state.copy, state.proxies) // yup that works for arrays as well\n        if (state.parent) markChanged(state.parent)\n    }\n}\n\n// creates a proxy for plain objects / arrays\nfunction createProxy(parentState, base) {\n    if (isProxy(base)) throw new Error(\"Immer bug. Plz report.\")\n    const state = createState(parentState, base)\n    const proxy = Array.isArray(base)\n        ? Proxy.revocable([state], arrayTraps)\n        : Proxy.revocable(state, objectTraps)\n    proxies.push(proxy)\n    return proxy.proxy\n}\n\nexport function produceProxy(baseState, producer) {\n    if (isProxy(baseState)) {\n        // See #100, don't nest producers\n        const returnValue = producer.call(baseState, baseState)\n        return returnValue === undefined ? baseState : returnValue\n    }\n    const previousProxies = proxies\n    proxies = []\n    try {\n        // create proxy for root\n        const rootProxy = createProxy(undefined, baseState)\n        // execute the thunk\n        const returnValue = producer.call(rootProxy, rootProxy)\n        // and finalize the modified proxy\n        let result\n        // check whether the draft was modified and/or a value was returned\n        if (returnValue !== undefined && returnValue !== rootProxy) {\n            // something was returned, and it wasn't the proxy itself\n            if (rootProxy[PROXY_STATE].modified)\n                throw new Error(RETURNED_AND_MODIFIED_ERROR)\n\n            // See #117\n            // Should we just throw when returning a proxy which is not the root, but a subset of the original state?\n            // Looks like a wrongly modeled reducer\n            result = finalize(returnValue)\n        } else {\n            result = finalize(rootProxy)\n        }\n        // revoke all proxies\n        each(proxies, (_, p) => p.revoke())\n        return result\n    } finally {\n        proxies = previousProxies\n    }\n}\n","\"use strict\"\n// @ts-check\n\nimport {\n    is,\n    isProxyable,\n    isProxy,\n    PROXY_STATE,\n    shallowCopy,\n    RETURNED_AND_MODIFIED_ERROR,\n    each,\n    finalize\n} from \"./common\"\n\nconst descriptors = {}\nlet states = null\n\nfunction createState(parent, proxy, base) {\n    return {\n        modified: false,\n        hasCopy: false,\n        parent,\n        base,\n        proxy,\n        copy: undefined,\n        finished: false,\n        finalizing: false,\n        finalized: false\n    }\n}\n\nfunction source(state) {\n    return state.hasCopy ? state.copy : state.base\n}\n\nfunction get(state, prop) {\n    assertUnfinished(state)\n    const value = source(state)[prop]\n    if (!state.finalizing && value === state.base[prop] && isProxyable(value)) {\n        // only create a proxy if the value is proxyable, and the value was in the base state\n        // if it wasn't in the base state, the object is already modified and we will process it in finalize\n        prepareCopy(state)\n        return (state.copy[prop] = createProxy(state, value))\n    }\n    return value\n}\n\nfunction set(state, prop, value) {\n    assertUnfinished(state)\n    if (!state.modified) {\n        if (is(source(state)[prop], value)) return\n        markChanged(state)\n        prepareCopy(state)\n    }\n    state.copy[prop] = value\n}\n\nfunction markChanged(state) {\n    if (!state.modified) {\n        state.modified = true\n        if (state.parent) markChanged(state.parent)\n    }\n}\n\nfunction prepareCopy(state) {\n    if (state.hasCopy) return\n    state.hasCopy = true\n    state.copy = shallowCopy(state.base)\n}\n\n// creates a proxy for plain objects / arrays\nfunction createProxy(parent, base) {\n    const proxy = shallowCopy(base)\n    each(base, i => {\n        Object.defineProperty(proxy, \"\" + i, createPropertyProxy(\"\" + i))\n    })\n    const state = createState(parent, proxy, base)\n    createHiddenProperty(proxy, PROXY_STATE, state)\n    states.push(state)\n    return proxy\n}\n\nfunction createPropertyProxy(prop) {\n    return (\n        descriptors[prop] ||\n        (descriptors[prop] = {\n            configurable: true,\n            enumerable: true,\n            get() {\n                return get(this[PROXY_STATE], prop)\n            },\n            set(value) {\n                set(this[PROXY_STATE], prop, value)\n            }\n        })\n    )\n}\n\nfunction assertUnfinished(state) {\n    if (state.finished === true)\n        throw new Error(\n            \"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? \" +\n                JSON.stringify(state.copy || state.base)\n        )\n}\n\n// this sounds very expensive, but actually it is not that expensive in practice\n// as it will only visit proxies, and only do key-based change detection for objects for\n// which it is not already know that they are changed (that is, only object for which no known key was changed)\nfunction markChanges() {\n    // intentionally we process the proxies in reverse order;\n    // ideally we start by processing leafs in the tree, because if a child has changed, we don't have to check the parent anymore\n    // reverse order of proxy creation approximates this\n    for (let i = states.length - 1; i >= 0; i--) {\n        const state = states[i]\n        if (state.modified === false) {\n            if (Array.isArray(state.base)) {\n                if (hasArrayChanges(state)) markChanged(state)\n            } else if (hasObjectChanges(state)) markChanged(state)\n        }\n    }\n}\n\nfunction hasObjectChanges(state) {\n    const baseKeys = Object.keys(state.base)\n    const keys = Object.keys(state.proxy)\n    return !shallowEqual(baseKeys, keys)\n}\n\nfunction hasArrayChanges(state) {\n    const {proxy} = state\n    if (proxy.length !== state.base.length) return true\n    // See #116\n    // If we first shorten the length, our array interceptors will be removed.\n    // If after that new items are added, result in the same original length,\n    // those last items will have no intercepting property.\n    // So if there is no own descriptor on the last position, we know that items were removed and added\n    // N.B.: splice, unshift, etc only shift values around, but not prop descriptors, so we only have to check\n    // the last one\n    const descriptor = Object.getOwnPropertyDescriptor(proxy, proxy.length - 1)\n    // descriptor can be null, but only for newly created sparse arrays, eg. new Array(10)\n    if (descriptor && !descriptor.get) return true\n    // For all other cases, we don't have to compare, as they would have been picked up by the index setters\n    return false\n}\n\nexport function produceEs5(baseState, producer) {\n    if (isProxy(baseState)) {\n        // See #100, don't nest producers\n        const returnValue = producer.call(baseState, baseState)\n        return returnValue === undefined ? baseState : returnValue\n    }\n    const prevStates = states\n    states = []\n    try {\n        // create proxy for root\n        const rootProxy = createProxy(undefined, baseState)\n        // execute the thunk\n        const returnValue = producer.call(rootProxy, rootProxy)\n        // and finalize the modified proxy\n        each(states, (_, state) => {\n            state.finalizing = true\n        })\n        // find and mark all changes (for parts not done yet)\n        // TODO: store states by depth, to be able guarantee processing leaves first\n        markChanges()\n        let result\n        // check whether the draft was modified and/or a value was returned\n        if (returnValue !== undefined && returnValue !== rootProxy) {\n            // something was returned, and it wasn't the proxy itself\n            if (rootProxy[PROXY_STATE].modified)\n                throw new Error(RETURNED_AND_MODIFIED_ERROR)\n            result = finalize(returnValue)\n        } else result = finalize(rootProxy)\n        // make sure all proxies become unusable\n        each(states, (_, state) => {\n            state.finished = true\n        })\n        return result\n    } finally {\n        states = prevStates\n    }\n}\n\nfunction shallowEqual(objA, objB) {\n    //From: https://github.com/facebook/fbjs/blob/c69904a511b900266935168223063dd8772dfc40/packages/fbjs/src/core/shallowEqual.js\n    if (is(objA, objB)) return true\n    if (\n        typeof objA !== \"object\" ||\n        objA === null ||\n        typeof objB !== \"object\" ||\n        objB === null\n    ) {\n        return false\n    }\n    const keysA = Object.keys(objA)\n    const keysB = Object.keys(objB)\n    if (keysA.length !== keysB.length) return false\n    for (let i = 0; i < keysA.length; i++) {\n        if (\n            !hasOwnProperty.call(objB, keysA[i]) ||\n            !is(objA[keysA[i]], objB[keysA[i]])\n        ) {\n            return false\n        }\n    }\n    return true\n}\n\nfunction createHiddenProperty(target, prop, value) {\n    Object.defineProperty(target, prop, {\n        value: value,\n        enumerable: false,\n        writable: true\n    })\n}\n","export {setAutoFreeze, setUseProxies} from \"./common\"\n\nimport {isProxyable, getUseProxies} from \"./common\"\nimport {produceProxy} from \"./proxy\"\nimport {produceEs5} from \"./es5\"\n\n/**\n * produce takes a state, and runs a function against it.\n * That function can freely mutate the state, as it will create copies-on-write.\n * This means that the original state will stay unchanged, and once the function finishes, the modified state is returned\n *\n * @export\n * @param {any} baseState - the state to start with\n * @param {Function} producer - function that receives a proxy of the base state as first argument and which can be freely modified\n * @returns {any} a new state, or the base state if nothing was modified\n */\nexport default function produce(baseState, producer) {\n    // prettier-ignore\n    if (arguments.length !== 1 && arguments.length !== 2) throw new Error(\"produce expects 1 or 2 arguments, got \" + arguments.length)\n\n    // curried invocation\n    if (typeof baseState === \"function\") {\n        // prettier-ignore\n        if (typeof producer === \"function\") throw new Error(\"if first argument is a function (curried invocation), the second argument to produce cannot be a function\")\n\n        const initialState = producer\n        const recipe = baseState\n\n        return function() {\n            const args = arguments\n\n            const currentState =\n                args[0] === undefined && initialState !== undefined\n                    ? initialState\n                    : args[0]\n\n            return produce(currentState, draft => {\n                args[0] = draft // blegh!\n                return recipe.apply(draft, args)\n            })\n        }\n    }\n\n    // prettier-ignore\n    {\n        if (typeof producer !== \"function\") throw new Error(\"if first argument is not a function, the second argument to produce should be a function\")\n    }\n\n    // if state is a primitive, don't bother proxying at all\n    if (typeof baseState !== \"object\" || baseState === null) {\n        const returnValue = producer(baseState)\n        return returnValue === undefined ? baseState : returnValue\n    }\n\n    if (!isProxyable(baseState))\n        throw new Error(\n            `the first argument to an immer producer should be a primitive, plain object or array, got ${typeof baseState}: \"${baseState}\"`\n        )\n    return getUseProxies()\n        ? produceProxy(baseState, producer)\n        : produceEs5(baseState, producer)\n}\n"],"names":["PROXY_STATE","Symbol","RETURNED_AND_MODIFIED_ERROR","verifyMinified","inProduction","process","env","NODE_ENV","name","autoFreeze","useProxies","Proxy","setAutoFreeze","enableAutoFreeze","setUseProxies","value","getUseProxies","isProxy","isProxyable","Array","isArray","proto","Object","getPrototypeOf","prototype","freeze","assign","target","key","has","shallowCopy","slice","__proto__","undefined","create","each","cb","i","length","thing","prop","hasOwnProperty","call","finalize","base","state","modified","finalized","copy","finalizeObject","finalizeNonProxiedObject","parent","isFrozen","child","is","x","y","proxies","objectTraps","source","Reflect","ownKeys","Error","arrayTraps","fn","arguments","apply","createState","get","createProxy","set","deleteProperty","getOwnPropertyDescriptor","owner","descriptor","configurable","defineProperty","markChanged","parentState","proxy","revocable","push","produceProxy","baseState","producer","returnValue","previousProxies","rootProxy","result","_","p","revoke","descriptors","states","hasCopy","finalizing","prepareCopy","createPropertyProxy","assertUnfinished","finished","JSON","stringify","markChanges","hasArrayChanges","hasObjectChanges","baseKeys","keys","shallowEqual","produceEs5","prevStates","objA","objB","keysA","keysB","createHiddenProperty","produce","initialState","recipe","args","currentState","draft"],"mappings":";;;;;;AAAO,IAAMA,cACT,OAAOC,MAAP,KAAkB,WAAlB,GACMA,OAAO,mBAAP,CADN,GAEM,gBAHH;;AAKP,AAAO,IAAMC,8BACT,mHADG;;AAGP,SAASC,cAAT,GAA0B;;AAE1B,IAAMC,eACD,OAAOC,OAAP,KAAmB,WAAnB,IAAkCA,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,YAA5D,IACAJ,eAAeK,IAAf,KAAwB,gBAF5B;;AAIA,IAAIC,aAAa,CAACL,YAAlB;AACA,IAAIM,aAAa,OAAOC,KAAP,KAAiB,WAAlC;;;;;;;;;;AAUA,AAAO,SAASC,aAAT,CAAuBC,gBAAvB,EAAyC;iBAC/BA,gBAAb;;;AAGJ,AAAO,SAASC,aAAT,CAAuBC,KAAvB,EAA8B;iBACpBA,KAAb;;;AAGJ,AAAO,SAASC,aAAT,GAAyB;WACrBN,UAAP;;;AAGJ,AAAO,SAASO,OAAT,CAAiBF,KAAjB,EAAwB;WACpB,CAAC,CAACA,KAAF,IAAW,CAAC,CAACA,MAAMf,WAAN,CAApB;;;AAGJ,AAAO,SAASkB,WAAT,CAAqBH,KAArB,EAA4B;QAC3B,CAACA,KAAL,EAAY,OAAO,KAAP;QACR,QAAOA,KAAP,yCAAOA,KAAP,OAAiB,QAArB,EAA+B,OAAO,KAAP;QAC3BI,MAAMC,OAAN,CAAcL,KAAd,CAAJ,EAA0B,OAAO,IAAP;QACpBM,QAAQC,OAAOC,cAAP,CAAsBR,KAAtB,CAAd;WACOM,UAAU,IAAV,IAAkBA,UAAUC,OAAOE,SAA1C;;;AAGJ,AAAO,SAASC,MAAT,CAAgBV,KAAhB,EAAuB;QACtBN,UAAJ,EAAgB;eACLgB,MAAP,CAAcV,KAAd;;WAEGA,KAAP;;;AAGJ,IAAMW,SACFJ,OAAOI,MAAP,IACA,SAASA,MAAT,CAAgBC,MAAhB,EAAwBZ,KAAxB,EAA+B;SACtB,IAAIa,GAAT,IAAgBb,KAAhB,EAAuB;YACfc,IAAId,KAAJ,EAAWa,GAAX,CAAJ,EAAqB;mBACVA,GAAP,IAAcb,MAAMa,GAAN,CAAd;;;WAGDD,MAAP;CARR;;AAWA,AAAO,SAASG,WAAT,CAAqBf,KAArB,EAA4B;QAC3BI,MAAMC,OAAN,CAAcL,KAAd,CAAJ,EAA0B,OAAOA,MAAMgB,KAAN,EAAP;QACpBJ,SAASZ,MAAMiB,SAAN,KAAoBC,SAApB,GAAgCX,OAAOY,MAAP,CAAc,IAAd,CAAhC,GAAsD,EAArE;WACOR,OAAOC,MAAP,EAAeZ,KAAf,CAAP;;;AAGJ,AAAO,SAASoB,IAAT,CAAcpB,KAAd,EAAqBqB,EAArB,EAAyB;QACxBjB,MAAMC,OAAN,CAAcL,KAAd,CAAJ,EAA0B;aACjB,IAAIsB,IAAI,CAAb,EAAgBA,IAAItB,MAAMuB,MAA1B,EAAkCD,GAAlC;eAA0CA,CAAH,EAAMtB,MAAMsB,CAAN,CAAN;;KAD3C,MAEO;aACE,IAAIT,GAAT,IAAgBb,KAAhB;eAA0Ba,GAAH,EAAQb,MAAMa,GAAN,CAAR;;;;;AAI/B,AAAO,SAASC,GAAT,CAAaU,KAAb,EAAoBC,IAApB,EAA0B;WACtBlB,OAAOE,SAAP,CAAiBiB,cAAjB,CAAgCC,IAAhC,CAAqCH,KAArC,EAA4CC,IAA5C,CAAP;;;;AAIJ,AAAO,SAASG,QAAT,CAAkBC,IAAlB,EAAwB;QACvB3B,QAAQ2B,IAAR,CAAJ,EAAmB;YACTC,QAAQD,KAAK5C,WAAL,CAAd;YACI6C,MAAMC,QAAN,KAAmB,IAAvB,EAA6B;gBACrBD,MAAME,SAAN,KAAoB,IAAxB,EAA8B,OAAOF,MAAMG,IAAb;kBACxBD,SAAN,GAAkB,IAAlB;mBACOE,eACHvC,aAAamC,MAAMG,IAAnB,GAA2BH,MAAMG,IAAN,GAAalB,YAAYc,IAAZ,CADrC,EAEHC,KAFG,CAAP;SAHJ,MAOO;mBACIA,MAAMD,IAAb;;;6BAGiBA,IAAzB;WACOA,IAAP;;;AAGJ,SAASK,cAAT,CAAwBD,IAAxB,EAA8BH,KAA9B,EAAqC;QAC3BD,OAAOC,MAAMD,IAAnB;SACKI,IAAL,EAAW,UAACR,IAAD,EAAOzB,KAAP,EAAiB;YACpBA,UAAU6B,KAAKJ,IAAL,CAAd,EAA0BQ,KAAKR,IAAL,IAAaG,SAAS5B,KAAT,CAAb;KAD9B;WAGOU,OAAOuB,IAAP,CAAP;;;AAGJ,SAASE,wBAAT,CAAkCC,MAAlC,EAA0C;;;QAGlC,CAACjC,YAAYiC,MAAZ,CAAL,EAA0B;QACtB7B,OAAO8B,QAAP,CAAgBD,MAAhB,CAAJ,EAA6B;SACxBA,MAAL,EAAa,UAACd,CAAD,EAAIgB,KAAJ,EAAc;YACnBpC,QAAQoC,KAAR,CAAJ,EAAoB;mBACThB,CAAP,IAAYM,SAASU,KAAT,CAAZ;SADJ,MAEOH,yBAAyBG,KAAzB;KAHX;;WAMOF,MAAP;;;AAGJ;;AAUA,AAAO,SAASG,EAAT,CAAYC,CAAZ,EAAeC,CAAf,EAAkB;;QAEjBD,MAAMC,CAAV,EAAa;eACFD,MAAM,CAAN,IAAW,IAAIA,CAAJ,KAAU,IAAIC,CAAhC;KADJ,MAEO;eACID,MAAMA,CAAN,IAAWC,MAAMA,CAAxB;;;;AC5IR;;AAEA,AAYA,IAAIC,UAAU,IAAd;;AAEA,IAAMC,cAAc;cAAA;OAAA,kBAEZ/B,MAFY,EAEJa,IAFI,EAEE;eACPA,QAAQmB,OAAOhC,MAAP,CAAf;KAHY;WAAA,mBAKRA,MALQ,EAKA;eACLiC,QAAQC,OAAR,CAAgBF,OAAOhC,MAAP,CAAhB,CAAP;KANY;;cAAA;kCAAA;sDAAA;oCAAA;kBAAA,4BAYC;cACP,IAAImC,KAAJ,CAAU,4CAAV,CAAN;;CAbR;;AAiBA,IAAMC,aAAa,EAAnB;AACA5B,KAAKuB,WAAL,EAAkB,UAAC9B,GAAD,EAAMoC,EAAN,EAAa;eAChBpC,GAAX,IAAkB,YAAW;kBACf,CAAV,IAAeqC,UAAU,CAAV,EAAa,CAAb,CAAf;eACOD,GAAGE,KAAH,CAAS,IAAT,EAAeD,SAAf,CAAP;KAFJ;CADJ;;AAOA,SAASE,WAAT,CAAqBhB,MAArB,EAA6BP,IAA7B,EAAmC;WACxB;kBACO,KADP;mBAEQ,KAFR;sBAAA;kBAAA;cAKGX,SALH;iBAMM;KANb;;;AAUJ,SAAS0B,MAAT,CAAgBd,KAAhB,EAAuB;WACZA,MAAMC,QAAN,KAAmB,IAAnB,GAA0BD,MAAMG,IAAhC,GAAuCH,MAAMD,IAApD;;;AAGJ,SAASwB,KAAT,CAAavB,KAAb,EAAoBL,IAApB,EAA0B;QAClBA,SAASxC,WAAb,EAA0B,OAAO6C,KAAP;QACtBA,MAAMC,QAAV,EAAoB;YACV/B,QAAQ8B,MAAMG,IAAN,CAAWR,IAAX,CAAd;YACIzB,UAAU8B,MAAMD,IAAN,CAAWJ,IAAX,CAAV,IAA8BtB,YAAYH,KAAZ,CAAlC;;;mBAGY8B,MAAMG,IAAN,CAAWR,IAAX,IAAmB6B,YAAYxB,KAAZ,EAAmB9B,KAAnB,CAA3B;eACGA,KAAP;KANJ,MAOO;YACCc,IAAIgB,MAAMY,OAAV,EAAmBjB,IAAnB,CAAJ,EAA8B,OAAOK,MAAMY,OAAN,CAAcjB,IAAd,CAAP;YACxBzB,SAAQ8B,MAAMD,IAAN,CAAWJ,IAAX,CAAd;YACI,CAACvB,QAAQF,MAAR,CAAD,IAAmBG,YAAYH,MAAZ,CAAvB,EACI,OAAQ8B,MAAMY,OAAN,CAAcjB,IAAd,IAAsB6B,YAAYxB,KAAZ,EAAmB9B,MAAnB,CAA9B;eACGA,MAAP;;;;AAIR,SAASuD,KAAT,CAAazB,KAAb,EAAoBL,IAApB,EAA0BzB,KAA1B,EAAiC;QACzB,CAAC8B,MAAMC,QAAX,EAAqB;YAEZN,QAAQK,MAAMD,IAAd,IAAsBU,GAAGT,MAAMD,IAAN,CAAWJ,IAAX,CAAH,EAAqBzB,KAArB,CAAvB,IACCc,IAAIgB,MAAMY,OAAV,EAAmBjB,IAAnB,KAA4BK,MAAMY,OAAN,CAAcjB,IAAd,MAAwBzB,KAFzD,EAII,OAAO,IAAP;oBACQ8B,KAAZ;;UAEEG,IAAN,CAAWR,IAAX,IAAmBzB,KAAnB;WACO,IAAP;;;AAGJ,SAASwD,cAAT,CAAwB1B,KAAxB,EAA+BL,IAA/B,EAAqC;gBACrBK,KAAZ;WACOA,MAAMG,IAAN,CAAWR,IAAX,CAAP;WACO,IAAP;;;AAGJ,SAASgC,wBAAT,CAAkC3B,KAAlC,EAAyCL,IAAzC,EAA+C;QACrCiC,QAAQ5B,MAAMC,QAAN,GACRD,MAAMG,IADE,GAERnB,IAAIgB,MAAMY,OAAV,EAAmBjB,IAAnB,IAA2BK,MAAMY,OAAjC,GAA2CZ,MAAMD,IAFvD;QAGM8B,aAAad,QAAQY,wBAAR,CAAiCC,KAAjC,EAAwCjC,IAAxC,CAAnB;QACIkC,cAAc,EAAEvD,MAAMC,OAAN,CAAcqD,KAAd,KAAwBjC,SAAS,QAAnC,CAAlB,EACIkC,WAAWC,YAAX,GAA0B,IAA1B;WACGD,UAAP;;;AAGJ,SAASE,gBAAT,GAA0B;UAChB,IAAId,KAAJ,CACF,8DADE,CAAN;;;AAKJ,SAASe,WAAT,CAAqBhC,KAArB,EAA4B;QACpB,CAACA,MAAMC,QAAX,EAAqB;cACXA,QAAN,GAAiB,IAAjB;cACME,IAAN,GAAalB,YAAYe,MAAMD,IAAlB,CAAb;;eAEOlB,MAAP,CAAcmB,MAAMG,IAApB,EAA0BH,MAAMY,OAAhC,EAJiB;YAKbZ,MAAMM,MAAV,EAAkB0B,YAAYhC,MAAMM,MAAlB;;;;;AAK1B,SAASkB,WAAT,CAAqBS,WAArB,EAAkClC,IAAlC,EAAwC;QAChC3B,QAAQ2B,IAAR,CAAJ,EAAmB,MAAM,IAAIkB,KAAJ,CAAU,wBAAV,CAAN;QACbjB,QAAQsB,YAAYW,WAAZ,EAAyBlC,IAAzB,CAAd;QACMmC,QAAQ5D,MAAMC,OAAN,CAAcwB,IAAd,IACRjC,MAAMqE,SAAN,CAAgB,CAACnC,KAAD,CAAhB,EAAyBkB,UAAzB,CADQ,GAERpD,MAAMqE,SAAN,CAAgBnC,KAAhB,EAAuBa,WAAvB,CAFN;YAGQuB,IAAR,CAAaF,KAAb;WACOA,MAAMA,KAAb;;;AAGJ,AAAO,SAASG,YAAT,CAAsBC,SAAtB,EAAiCC,QAAjC,EAA2C;QAC1CnE,QAAQkE,SAAR,CAAJ,EAAwB;;YAEdE,cAAcD,SAAS1C,IAAT,CAAcyC,SAAd,EAAyBA,SAAzB,CAApB;eACOE,gBAAgBpD,SAAhB,GAA4BkD,SAA5B,GAAwCE,WAA/C;;QAEEC,kBAAkB7B,OAAxB;cACU,EAAV;QACI;;YAEM8B,YAAYlB,YAAYpC,SAAZ,EAAuBkD,SAAvB,CAAlB;;YAEME,eAAcD,SAAS1C,IAAT,CAAc6C,SAAd,EAAyBA,SAAzB,CAApB;;YAEIC,eAAJ;;YAEIH,iBAAgBpD,SAAhB,IAA6BoD,iBAAgBE,SAAjD,EAA4D;;gBAEpDA,UAAUvF,WAAV,EAAuB8C,QAA3B,EACI,MAAM,IAAIgB,KAAJ,CAAU5D,2BAAV,CAAN;;;;;qBAKKyC,SAAS0C,YAAT,CAAT;SARJ,MASO;qBACM1C,SAAS4C,SAAT,CAAT;;;aAGC9B,OAAL,EAAc,UAACgC,CAAD,EAAIC,CAAJ;mBAAUA,EAAEC,MAAF,EAAV;SAAd;eACOH,MAAP;KAtBJ,SAuBU;kBACIF,eAAV;;;;AClKR;;AAEA,AAWA,IAAMM,cAAc,EAApB;AACA,IAAIC,SAAS,IAAb;;AAEA,SAAS1B,aAAT,CAAqBhB,MAArB,EAA6B4B,KAA7B,EAAoCnC,IAApC,EAA0C;WAC/B;kBACO,KADP;iBAEM,KAFN;sBAAA;kBAAA;oBAAA;cAMGX,SANH;kBAOO,KAPP;oBAQS,KART;mBASQ;KATf;;;AAaJ,SAAS0B,QAAT,CAAgBd,KAAhB,EAAuB;WACZA,MAAMiD,OAAN,GAAgBjD,MAAMG,IAAtB,GAA6BH,MAAMD,IAA1C;;;AAGJ,SAASwB,IAAT,CAAavB,KAAb,EAAoBL,IAApB,EAA0B;qBACLK,KAAjB;QACM9B,QAAQ4C,SAAOd,KAAP,EAAcL,IAAd,CAAd;QACI,CAACK,MAAMkD,UAAP,IAAqBhF,UAAU8B,MAAMD,IAAN,CAAWJ,IAAX,CAA/B,IAAmDtB,YAAYH,KAAZ,CAAvD,EAA2E;;;oBAG3D8B,KAAZ;eACQA,MAAMG,IAAN,CAAWR,IAAX,IAAmB6B,cAAYxB,KAAZ,EAAmB9B,KAAnB,CAA3B;;WAEGA,KAAP;;;AAGJ,SAASuD,IAAT,CAAazB,KAAb,EAAoBL,IAApB,EAA0BzB,KAA1B,EAAiC;qBACZ8B,KAAjB;QACI,CAACA,MAAMC,QAAX,EAAqB;YACbQ,GAAGK,SAAOd,KAAP,EAAcL,IAAd,CAAH,EAAwBzB,KAAxB,CAAJ,EAAoC;sBACxB8B,KAAZ;oBACYA,KAAZ;;UAEEG,IAAN,CAAWR,IAAX,IAAmBzB,KAAnB;;;AAGJ,SAAS8D,aAAT,CAAqBhC,KAArB,EAA4B;QACpB,CAACA,MAAMC,QAAX,EAAqB;cACXA,QAAN,GAAiB,IAAjB;YACID,MAAMM,MAAV,EAAkB0B,cAAYhC,MAAMM,MAAlB;;;;AAI1B,SAAS6C,WAAT,CAAqBnD,KAArB,EAA4B;QACpBA,MAAMiD,OAAV,EAAmB;UACbA,OAAN,GAAgB,IAAhB;UACM9C,IAAN,GAAalB,YAAYe,MAAMD,IAAlB,CAAb;;;;AAIJ,SAASyB,aAAT,CAAqBlB,MAArB,EAA6BP,IAA7B,EAAmC;QACzBmC,QAAQjD,YAAYc,IAAZ,CAAd;SACKA,IAAL,EAAW,aAAK;eACLgC,cAAP,CAAsBG,KAAtB,EAA6B,KAAK1C,CAAlC,EAAqC4D,oBAAoB,KAAK5D,CAAzB,CAArC;KADJ;QAGMQ,QAAQsB,cAAYhB,MAAZ,EAAoB4B,KAApB,EAA2BnC,IAA3B,CAAd;yBACqBmC,KAArB,EAA4B/E,WAA5B,EAAyC6C,KAAzC;WACOoC,IAAP,CAAYpC,KAAZ;WACOkC,KAAP;;;AAGJ,SAASkB,mBAAT,CAA6BzD,IAA7B,EAAmC;WAE3BoD,YAAYpD,IAAZ,MACCoD,YAAYpD,IAAZ,IAAoB;sBACH,IADG;oBAEL,IAFK;WAAA,oBAGX;mBACK4B,KAAI,KAAKpE,WAAL,CAAJ,EAAuBwC,IAAvB,CAAP;SAJa;WAAA,kBAMbzB,KANa,EAMN;iBACH,KAAKf,WAAL,CAAJ,EAAuBwC,IAAvB,EAA6BzB,KAA7B;;KARR,CADJ;;;AAeJ,SAASmF,gBAAT,CAA0BrD,KAA1B,EAAiC;QACzBA,MAAMsD,QAAN,KAAmB,IAAvB,EACI,MAAM,IAAIrC,KAAJ,CACF,yHACIsC,KAAKC,SAAL,CAAexD,MAAMG,IAAN,IAAcH,MAAMD,IAAnC,CAFF,CAAN;;;;;;AASR,SAAS0D,WAAT,GAAuB;;;;SAId,IAAIjE,IAAIwD,OAAOvD,MAAP,GAAgB,CAA7B,EAAgCD,KAAK,CAArC,EAAwCA,GAAxC,EAA6C;YACnCQ,QAAQgD,OAAOxD,CAAP,CAAd;YACIQ,MAAMC,QAAN,KAAmB,KAAvB,EAA8B;gBACtB3B,MAAMC,OAAN,CAAcyB,MAAMD,IAApB,CAAJ,EAA+B;oBACvB2D,gBAAgB1D,KAAhB,CAAJ,EAA4BgC,cAAYhC,KAAZ;aADhC,MAEO,IAAI2D,iBAAiB3D,KAAjB,CAAJ,EAA6BgC,cAAYhC,KAAZ;;;;;AAKhD,SAAS2D,gBAAT,CAA0B3D,KAA1B,EAAiC;QACvB4D,WAAWnF,OAAOoF,IAAP,CAAY7D,MAAMD,IAAlB,CAAjB;QACM8D,OAAOpF,OAAOoF,IAAP,CAAY7D,MAAMkC,KAAlB,CAAb;WACO,CAAC4B,aAAaF,QAAb,EAAuBC,IAAvB,CAAR;;;AAGJ,SAASH,eAAT,CAAyB1D,KAAzB,EAAgC;QACrBkC,KADqB,GACZlC,KADY,CACrBkC,KADqB;;QAExBA,MAAMzC,MAAN,KAAiBO,MAAMD,IAAN,CAAWN,MAAhC,EAAwC,OAAO,IAAP;;;;;;;;QAQlCoC,aAAapD,OAAOkD,wBAAP,CAAgCO,KAAhC,EAAuCA,MAAMzC,MAAN,GAAe,CAAtD,CAAnB;;QAEIoC,cAAc,CAACA,WAAWN,GAA9B,EAAmC,OAAO,IAAP;;WAE5B,KAAP;;;AAGJ,AAAO,SAASwC,UAAT,CAAoBzB,SAApB,EAA+BC,QAA/B,EAAyC;QACxCnE,QAAQkE,SAAR,CAAJ,EAAwB;;YAEdE,cAAcD,SAAS1C,IAAT,CAAcyC,SAAd,EAAyBA,SAAzB,CAApB;eACOE,gBAAgBpD,SAAhB,GAA4BkD,SAA5B,GAAwCE,WAA/C;;QAEEwB,aAAahB,MAAnB;aACS,EAAT;QACI;;YAEMN,YAAYlB,cAAYpC,SAAZ,EAAuBkD,SAAvB,CAAlB;;YAEME,eAAcD,SAAS1C,IAAT,CAAc6C,SAAd,EAAyBA,SAAzB,CAApB;;aAEKM,MAAL,EAAa,UAACJ,CAAD,EAAI5C,KAAJ,EAAc;kBACjBkD,UAAN,GAAmB,IAAnB;SADJ;;;;YAMIP,eAAJ;;YAEIH,iBAAgBpD,SAAhB,IAA6BoD,iBAAgBE,SAAjD,EAA4D;;gBAEpDA,UAAUvF,WAAV,EAAuB8C,QAA3B,EACI,MAAM,IAAIgB,KAAJ,CAAU5D,2BAAV,CAAN;qBACKyC,SAAS0C,YAAT,CAAT;SAJJ,MAKOG,SAAS7C,SAAS4C,SAAT,CAAT;;aAEFM,MAAL,EAAa,UAACJ,CAAD,EAAI5C,KAAJ,EAAc;kBACjBsD,QAAN,GAAiB,IAAjB;SADJ;eAGOX,MAAP;KAxBJ,SAyBU;iBACGqB,UAAT;;;;AAIR,SAASF,YAAT,CAAsBG,IAAtB,EAA4BC,IAA5B,EAAkC;;QAE1BzD,GAAGwD,IAAH,EAASC,IAAT,CAAJ,EAAoB,OAAO,IAAP;QAEhB,QAAOD,IAAP,yCAAOA,IAAP,OAAgB,QAAhB,IACAA,SAAS,IADT,IAEA,QAAOC,IAAP,yCAAOA,IAAP,OAAgB,QAFhB,IAGAA,SAAS,IAJb,EAKE;eACS,KAAP;;QAEEC,QAAQ1F,OAAOoF,IAAP,CAAYI,IAAZ,CAAd;QACMG,QAAQ3F,OAAOoF,IAAP,CAAYK,IAAZ,CAAd;QACIC,MAAM1E,MAAN,KAAiB2E,MAAM3E,MAA3B,EAAmC,OAAO,KAAP;SAC9B,IAAID,IAAI,CAAb,EAAgBA,IAAI2E,MAAM1E,MAA1B,EAAkCD,GAAlC,EAAuC;YAE/B,CAACI,eAAeC,IAAf,CAAoBqE,IAApB,EAA0BC,MAAM3E,CAAN,CAA1B,CAAD,IACA,CAACiB,GAAGwD,KAAKE,MAAM3E,CAAN,CAAL,CAAH,EAAmB0E,KAAKC,MAAM3E,CAAN,CAAL,CAAnB,CAFL,EAGE;mBACS,KAAP;;;WAGD,IAAP;;;AAGJ,SAAS6E,oBAAT,CAA8BvF,MAA9B,EAAsCa,IAAtC,EAA4CzB,KAA5C,EAAmD;WACxC6D,cAAP,CAAsBjD,MAAtB,EAA8Ba,IAA9B,EAAoC;eACzBzB,KADyB;oBAEpB,KAFoB;kBAGtB;KAHd;;;AC5MJ;;;;;;;;;;AAUA,AAAe,SAASoG,OAAT,CAAiBhC,SAAjB,EAA4BC,QAA5B,EAAsC;;QAE7CnB,UAAU3B,MAAV,KAAqB,CAArB,IAA0B2B,UAAU3B,MAAV,KAAqB,CAAnD,EAAsD,MAAM,IAAIwB,KAAJ,CAAU,2CAA2CG,UAAU3B,MAA/D,CAAN;;;QAGlD,OAAO6C,SAAP,KAAqB,UAAzB,EAAqC;;YAE7B,OAAOC,QAAP,KAAoB,UAAxB,EAAoC,MAAM,IAAItB,KAAJ,CAAU,2GAAV,CAAN;;YAE9BsD,eAAehC,QAArB;YACMiC,SAASlC,SAAf;;eAEO,YAAW;gBACRmC,OAAOrD,SAAb;;gBAEMsD,eACFD,KAAK,CAAL,MAAYrF,SAAZ,IAAyBmF,iBAAiBnF,SAA1C,GACMmF,YADN,GAEME,KAAK,CAAL,CAHV;;mBAKOH,QAAQI,YAAR,EAAsB,iBAAS;qBAC7B,CAAL,IAAUC,KAAV,CADkC;uBAE3BH,OAAOnD,KAAP,CAAasD,KAAb,EAAoBF,IAApB,CAAP;aAFG,CAAP;SARJ;;;;;YAiBI,OAAOlC,QAAP,KAAoB,UAAxB,EAAoC,MAAM,IAAItB,KAAJ,CAAU,0FAAV,CAAN;;;;QAIpC,QAAOqB,SAAP,yCAAOA,SAAP,OAAqB,QAArB,IAAiCA,cAAc,IAAnD,EAAyD;YAC/CE,cAAcD,SAASD,SAAT,CAApB;eACOE,gBAAgBpD,SAAhB,GAA4BkD,SAA5B,GAAwCE,WAA/C;;;QAGA,CAACnE,YAAYiE,SAAZ,CAAL,EACI,MAAM,IAAIrB,KAAJ,wGACkGqB,SADlG,yCACkGA,SADlG,cACiHA,SADjH,QAAN;WAGGnE,kBACDkE,aAAaC,SAAb,EAAwBC,QAAxB,CADC,GAEDwB,WAAWzB,SAAX,EAAsBC,QAAtB,CAFN;;;;;;"}